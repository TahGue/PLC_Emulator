# Pentest Simulation Playbook (ICS-Safe)

This playbook defines a controlled, legal workflow for simulating ICS attack paths in the emulator and validating detection + response behavior.

## Scope and Safety

- Use only lab systems you own or are explicitly authorized to test.
- This playbook is for simulation/training, not unauthorized testing.
- Keep all tooling pointed at localhost or isolated lab networks.

## Objectives

1. Validate security signal generation under attack conditions.
2. Validate PLC lockout behavior (`I:0/8`, `I:0/9` -> `O:0/8`).
3. Collect reproducible evidence (logs, screenshots, reports).

## Environment Preparation

1. Start frontend:
   ```bash
   python3 -m http.server 8000
   ```
2. (Optional backend) start analyzer stack:
   ```bash
   docker compose up --build -d
   ```
3. Verify backend health:
   - `http://localhost:8001/health`

## Test Matrix

| Scenario | Attack/Failure | Expected Signal | Expected Outcome |
|----------|----------------|-----------------|------------------|
| Baseline | none | low process + network score | normal operation |
| Network DoS | DoS / Packet Flood | network score rises | lockout path may engage |
| MITM | Man-in-the-Middle | network/process indicators shift | anomaly + impact feed updates |
| Physical fault | Sensor Drift | process behavior degrades | station KPI drop, alarms |
| Combined | replay + failures | multi-lane anomalies | highest risk / response needed |

## Procedure

1. Capture baseline for 2 minutes.
2. Activate one scenario from matrix.
3. Record:
   - packet stats
   - scan timings
   - station KPI changes
   - alarms and detection feed
4. Verify mitigation action:
   - deactivate attack/failure
   - observe return to baseline
5. Repeat for all scenarios.

## Optional OpenPLC Integration Checks

If using OpenPLC bridge:

```bash
python backend/scripts/openplc_modbus_bridge.py \
  --analyzer-base-url http://localhost:8001 \
  --openplc-host 127.0.0.1 \
  --openplc-port 502
```

Then run validator:

```bash
python backend/scripts/openplc_runtime_validator.py \
  --openplc-host 127.0.0.1 \
  --openplc-port 502 \
  --report-json backend/logs/openplc_validation_report.json
```

## Evidence Checklist

- [ ] Scenario name + timestamp
- [ ] Before/after screenshots (I/O, scan debugger, risk panels)
- [ ] Detection feed entries
- [ ] Alarm transitions
- [ ] Mitigation action and recovery time
- [ ] Optional validator report JSON

## Reporting Template

- **Scenario:**
- **Initial state:**
- **Observed indicators:**
- **Impact:**
- **Mitigation applied:**
- **Recovery time:**
- **Recommended hardening:**

## Recommended Hardening Follow-ups

- Add/verify interlocks for critical outputs.
- Tighten detection thresholds with baseline data.
- Add runbook steps for lockout and safe restart.
- Create periodic replay drills using this playbook.
