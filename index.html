<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLC Factory Emulator</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="app-container">
        <!-- ‚îÄ‚îÄ Header ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <header class="app-header">
            <div class="header-left">
                <h1>‚ö° PLC Factory Emulator</h1>
            </div>
            <div class="header-center">
                <div class="status-bar">
                    <div class="status-item">
                        <span class="status-label">PLC</span>
                        <span id="plc-status" class="status-value plc-stopped">STOPPED</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Mode</span>
                        <span id="mode-status" class="status-value">EDIT</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Components</span>
                        <span id="comp-count" class="status-value">0</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Wires</span>
                        <span id="wire-count" class="status-value">0</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Backend</span>
                        <span id="backend-status" class="status-value backend-offline">OFFLINE</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Stream</span>
                        <span id="stream-status" class="status-value backend-offline">OFF</span>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <div class="mode-toggle">
                    <button id="mode-edit-btn" class="mode-btn active" title="Edit Mode">‚úèÔ∏è Edit</button>
                    <button id="mode-sim-btn" class="mode-btn" title="Simulate Mode">‚ñ∂Ô∏è Simulate</button>
                </div>
            </div>
        </header>

        <!-- ‚îÄ‚îÄ Editor Toolbar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <div class="editor-toolbar">
            <div class="toolbar-group">
                <button id="zoom-in-btn" class="tool-btn" title="Zoom In">üîç+</button>
                <button id="zoom-out-btn" class="tool-btn" title="Zoom Out">üîç‚àí</button>
                <button id="zoom-fit-btn" class="tool-btn" title="Fit View">‚äû</button>
                <button id="toggle-grid-btn" class="tool-btn active" title="Toggle Grid">‚äû Grid</button>
                <button id="toggle-snap-btn" class="tool-btn active" title="Toggle Snap">üß≤ Snap</button>
            </div>
            <div class="toolbar-group">
                <label class="tool-label">Presets:</label>
                <select id="preset-select" class="tool-select">
                    <option value="">‚Äî Empty Canvas ‚Äî</option>
                    <option value="bottle_factory">Bottle Factory Line</option>
                    <option value="sorting_station">Sorting Station</option>
                    <option value="mixing_process">Mixing Process</option>
                    <option value="conveyor_merge">Conveyor Merge Control</option>
                    <option value="cip_sequence">CIP Cleaning Cycle</option>
                </select>
                <button id="load-preset-btn" class="tool-btn">Load</button>
            </div>
            <div class="toolbar-group">
                <button id="save-layout-btn" class="tool-btn" title="Save Layout">üíæ Save</button>
                <button id="load-layout-btn" class="tool-btn" title="Load Layout">üìÇ Load</button>
                <button id="clear-layout-btn" class="tool-btn tool-btn-danger" title="Clear All">üóëÔ∏è Clear</button>
            </div>
            <div class="toolbar-group toolbar-sim-controls" id="sim-controls" style="display:none;">
                <button id="start-btn" class="control-btn start-btn">‚ñ∂ START</button>
                <button id="stop-btn" class="control-btn stop-btn">‚èπ STOP</button>
                <button id="reset-btn" class="control-btn reset-btn">‚Ü∫ RESET</button>
                <button id="emergency-btn" class="control-btn emergency-btn">‚ö† E-STOP</button>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ Main Workspace ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <div class="editor-workspace">
            <!-- Component Palette (Left Sidebar) -->
            <div class="component-palette" id="component-palette">
                <div class="palette-header">Components</div>
                <div class="palette-search">
                    <input type="text" id="palette-search" placeholder="Search components..." />
                </div>
                <div id="palette-categories" class="palette-categories">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- SVG Canvas (Center) -->
            <div class="editor-canvas-wrapper">
                <svg id="editor-canvas" class="editor-canvas"></svg>
                <div class="canvas-hint" id="canvas-hint">
                    Drag components from the palette ‚Üí Drop on canvas ‚Üí Connect ports by clicking
                </div>
            </div>

            <!-- Property Panel (Right Sidebar) -->
            <div class="property-panel" id="property-panel">
                <div class="panel-header">Properties</div>
                <div id="prop-content" class="prop-content">
                    <div class="prop-placeholder">Select a component to edit its properties</div>
                </div>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ Detail Sections (Below Editor) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <div class="detail-grid">
            <!-- Ladder Logic -->
            <section class="ladder-section">
                <h2>Ladder Logic</h2>
                <div class="ladder-container">
                    <canvas id="ladder-canvas" width="400" height="600"></canvas>
                </div>
                <div class="ladder-controls">
                    <button id="edit-ladder-btn" class="control-btn">Edit Logic</button>
                    <button id="run-scan-btn" class="control-btn">Run Scan</button>
                </div>
            </section>

            <!-- I/O Status -->
            <section class="io-section">
                <h2>I/O Status</h2>
                <div class="io-grid">
                    <div class="io-group">
                        <h3>Inputs (I:0/0 ‚Äì I:0/15)</h3>
                        <div class="io-list" id="io-inputs-list">
                            <!-- Populated by JS from engine address map -->
                        </div>
                    </div>
                    <div class="io-group">
                        <h3>Outputs (O:0/0 ‚Äì O:0/15)</h3>
                        <div class="io-list" id="io-outputs-list">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Real-Time Monitoring -->
        <section class="monitoring-section">
            <h2>Real-Time Monitoring &amp; Analysis</h2>
            <div class="monitoring-grid">
                <div class="metric-card">
                    <h3>Components</h3>
                    <div class="metric-value" id="metric-components">0</div>
                    <div class="metric-unit">placed</div>
                </div>
                <div class="metric-card">
                    <h3>Active Sensors</h3>
                    <div class="metric-value" id="metric-sensors">0</div>
                    <div class="metric-unit">triggered</div>
                </div>
                <div class="metric-card">
                    <h3>Active Actuators</h3>
                    <div class="metric-value" id="metric-actuators">0</div>
                    <div class="metric-unit">running</div>
                </div>
                <div class="metric-card">
                    <h3>Cycle Time</h3>
                    <div class="metric-value" id="cycle-time">100ms</div>
                    <div class="metric-unit">PLC scan</div>
                </div>
                <div class="metric-card">
                    <h3>Process Score</h3>
                    <div class="metric-value" id="anomaly-score">0</div>
                    <div class="metric-unit">0-100</div>
                </div>
                <div class="metric-card">
                    <h3>Network Score</h3>
                    <div class="metric-value" id="network-risk">0</div>
                    <div class="metric-unit">0-100</div>
                </div>
                <div class="metric-card">
                    <h3>Confidence</h3>
                    <div class="metric-value" id="model-confidence">100</div>
                    <div class="metric-unit">%</div>
                </div>
                <div class="metric-card">
                    <h3>Packet Rate</h3>
                    <div class="metric-value" id="packet-rate-live">130</div>
                    <div class="metric-unit">pkt/s</div>
                </div>
            </div>
        </section>

        <!-- Attack Simulation Panel -->
        <section class="attack-section">
            <div class="attack-header">
                <h2>üõ°Ô∏è Attack Simulation Lab</h2>
                <div class="attack-header-controls">
                    <span class="attack-status" id="attack-status">No attacks active</span>
                    <button id="attack-reset-btn" class="control-btn" title="Deactivate all attacks">üõë Reset
                        All</button>
                </div>
            </div>

            <div class="attack-layout">
                <!-- Attack List -->
                <div class="attack-list-panel">
                    <h3>Available Attacks</h3>
                    <div class="attack-category-filter">
                        <button class="attack-filter-btn active" data-filter="all">All</button>
                        <button class="attack-filter-btn" data-filter="network">Network</button>
                        <button class="attack-filter-btn" data-filter="protocol">Protocol</button>
                        <button class="attack-filter-btn" data-filter="process">Process</button>
                        <button class="attack-filter-btn" data-filter="physical">Physical</button>
                    </div>
                    <div class="attack-list" id="attack-list">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Real-Time Packet Monitor -->
                <div class="packet-monitor-panel">
                    <h3>Real-Time Packet Analysis</h3>
                    <div class="packet-stats-row">
                        <div class="packet-stat">
                            <span class="packet-stat-label">Rate</span>
                            <span class="packet-stat-value" id="pkt-rate">130</span>
                            <span class="packet-stat-unit">pkt/s</span>
                        </div>
                        <div class="packet-stat">
                            <span class="packet-stat-label">Burst</span>
                            <span class="packet-stat-value" id="pkt-burst">0.15</span>
                            <span class="packet-stat-unit">ratio</span>
                        </div>
                        <div class="packet-stat">
                            <span class="packet-stat-label">Unauth</span>
                            <span class="packet-stat-value" id="pkt-unauth">0</span>
                            <span class="packet-stat-unit">attempts</span>
                        </div>
                        <div class="packet-stat">
                            <span class="packet-stat-label">Malicious</span>
                            <span class="packet-stat-value" id="pkt-malicious">0%</span>
                            <span class="packet-stat-unit">ratio</span>
                        </div>
                    </div>
                    <div class="packet-bars">
                        <div class="packet-bar-row">
                            <span class="bar-label">Normal</span>
                            <div class="bar-track">
                                <div class="bar-fill bar-normal" id="bar-normal" style="width:100%"></div>
                            </div>
                        </div>
                        <div class="packet-bar-row">
                            <span class="bar-label">Burst</span>
                            <div class="bar-track">
                                <div class="bar-fill bar-burst" id="bar-burst" style="width:0%"></div>
                            </div>
                        </div>
                        <div class="packet-bar-row">
                            <span class="bar-label">Malicious</span>
                            <div class="bar-track">
                                <div class="bar-fill bar-malicious" id="bar-malicious" style="width:0%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="packet-log" id="packet-log">
                        <div class="packet-log-header">
                            <span>Time</span><span>Source</span><span>Dest</span><span>Proto</span><span>Len</span><span>Type</span>
                        </div>
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Analysis & Impact -->
                <div class="analysis-impact-panel">
                    <h3>Analysis &amp; Impact</h3>
                    <div class="risk-indicator">
                        <div class="risk-gauge" id="risk-gauge">
                            <div class="risk-gauge-fill" id="risk-gauge-fill"></div>
                            <span class="risk-gauge-label" id="risk-gauge-label">LOW</span>
                        </div>
                    </div>
                    <div class="analysis-detail">
                        <div class="explainability-row"><span>Risk Level</span><strong id="risk-level"
                                class="risk-pill risk-low">LOW</strong></div>
                        <div class="explainability-row"><span>Security Flag</span><strong
                                id="security-flag">CLEAR</strong></div>
                        <div class="explainability-row"><span>Action</span><strong id="recommended-action"
                                class="action-text">Continue baseline monitoring.</strong></div>
                    </div>
                    <div class="component-block">
                        <h4>Process Score Components</h4>
                        <div id="process-components" class="component-list"></div>
                    </div>
                    <div class="component-block">
                        <h4>Network Score Components</h4>
                        <div id="network-components" class="component-list"></div>
                    </div>

                    <h4>Component Impact Feed</h4>
                    <div class="impact-feed" id="impact-feed">
                        <div class="no-alarms">No component impacts</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ML Anomaly Detection Panel -->
        <section class="anomaly-section" id="anomaly-section">
            <div class="anomaly-header">
                <h2>üß† LSTM Anomaly Detection</h2>
                <div class="anomaly-header-controls">
                    <span class="anomaly-model-badge" id="anomaly-model-badge">Model: not loaded</span>
                    <span class="anomaly-status-badge" id="anomaly-status-badge">Idle</span>
                </div>
            </div>
            <div class="anomaly-layout">
                <!-- Anomaly Score Gauge + History -->
                <div class="anomaly-score-panel">
                    <h3>Anomaly Score</h3>
                    <div class="anomaly-gauge-wrap">
                        <canvas id="anomaly-gauge-canvas" width="200" height="120"></canvas>
                        <div class="anomaly-score-value" id="anomaly-score-value">0.0</div>
                        <div class="anomaly-score-label">reconstruction error</div>
                    </div>
                    <div class="anomaly-stats-row">
                        <div class="anomaly-stat">
                            <span class="anomaly-stat-label">Threshold</span>
                            <span class="anomaly-stat-value" id="anomaly-threshold">‚Äî</span>
                        </div>
                        <div class="anomaly-stat">
                            <span class="anomaly-stat-label">Inference</span>
                            <span class="anomaly-stat-value" id="anomaly-inference-ms">‚Äî ms</span>
                        </div>
                        <div class="anomaly-stat">
                            <span class="anomaly-stat-label">Buffer</span>
                            <span class="anomaly-stat-value" id="anomaly-buffer-fill">0%</span>
                        </div>
                    </div>
                    <div class="anomaly-verdict" id="anomaly-verdict">Waiting for data...</div>
                </div>
                <!-- Score History Chart -->
                <div class="anomaly-chart-panel">
                    <h3>Score History (last 60 ticks)</h3>
                    <canvas id="anomaly-history-canvas" width="500" height="180"></canvas>
                </div>
                <!-- Feature Error Breakdown -->
                <div class="anomaly-features-panel">
                    <h3>Feature Error Breakdown</h3>
                    <div class="anomaly-feature-bars" id="anomaly-feature-bars">
                        <!-- Populated by JS -->
                    </div>
                    <h3 style="margin-top:12px">Attack Classification</h3>
                    <div class="anomaly-attack-probs" id="anomaly-attack-probs">
                        <div class="anomaly-no-data">No attack detected</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Event Feed & Alarms -->
        <section class="monitoring-section">
            <div class="ml-lab-grid">
                <div class="ml-card">
                    <h3>Session KPIs</h3>
                    <div class="kpi-row"><span>Analyses Run</span><strong id="analysis-count">0</strong></div>
                    <div class="kpi-row"><span>Anomaly Hit Rate</span><strong id="anomaly-hit-rate">0%</strong></div>
                    <div class="kpi-row"><span>Avg Inference Latency</span><strong id="avg-inference-latency">0
                            ms</strong></div>
                    <div class="kpi-row"><span>Active Attacks</span><strong id="active-attack-count">0</strong></div>
                    <button id="export-report-btn" class="control-btn export-btn">Export Demo Report</button>
                </div>
                <div class="ml-card">
                    <h3>Model Explainability</h3>
                    <div class="explainability-row"><span>Model Version</span><strong
                            id="model-version">real-time-analyzer-v1</strong></div>
                    <div class="explainability-row"><span>Process Source</span><strong
                            id="process-source">local-analysis</strong></div>
                    <div class="explainability-row"><span>Network Source</span><strong
                            id="network-source">packet-monitor</strong></div>
                    <div class="explainability-row"><span>Vision Inference</span><strong id="vision-inference-ms">0
                            ms</strong></div>
                </div>
            </div>
            <div class="insights-section">
                <h3>Anomaly + Security Feed</h3>
                <div id="detection-feed" class="detection-feed">
                    <div class="no-alarms">No anomaly or security events</div>
                </div>
            </div>
            <div class="alarms-section">
                <h3>Active Alarms</h3>
                <div id="alarms-list" class="alarms-list">
                    <div class="no-alarms">No active alarms</div>
                </div>
            </div>
        </section>
    </div>

    <!-- Hidden file input for layout import -->
    <input type="file" id="layout-file-input" accept=".json" style="display:none" />

    <script src="plc-core.js"></script>
    <script src="component-registry.js"></script>
    <script src="simulation-engine.js"></script>
    <script src="layout-editor.js"></script>
    <script src="ladder-logic.js"></script>
    <script src="telemetry-client.js"></script>
    <script src="attack-simulator.js"></script>
    <script src="app.js"></script>
</body>

</html>